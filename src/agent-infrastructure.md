# 编码智能体基础设施

## 查询算法

### BM25算法

BM25 是一种基于概率的信息检索算法，用于评估文档与查询之间的相关性。BM25 算法的核心思想是通过计算文档中的关键词与查询中的关键词之间的匹配程度，来评估文档与查询之间的相关性。

Elasticsearch ？

### jaccard相似度

Jaccard 相似度是一种用于计算两个集合之间相似度的方法，它是通过计算两个集合的交集与并集之间的比例来评估它们之间的相似度。

###  TF-IDF

TF-IDF 是一种用于评估文档中关键词重要性的方法，它通过计算关键词在文档中的频率和在整个文档集合中的逆文档频率来评估关键词的重要性。

## 向量数据存储

### 示例：JetBrains + Local Storage

JetBrains 在进行 IDE 搜索时支持 LocalEmbeddingIndexFileManager 的方式，从远程服务器下载嵌入向量数据，然后将其存储在本地文件系统中。
降低了对远程服务器的依赖，提高了性能和稳定性。

优势：

- 高效的读写操作。使用`RandomAccessFile`进行随机访问，提供高效的读写能力，避免了将整个文件加载到内存中，提高了性能。
- 内存使用优化。通过按需加载和写入数据，显著减少内存占用，非常适用于大规模嵌入向量存储场景。
- 便于管理和维护。将ID和嵌入向量分开存储，分别为JSON文件和二进制文件，便于管理和维护。
- 扩展性强。通过构造函数中的`dimensions`参数，可以灵活设置嵌入向量的维度，适应不同的需求。

缺点：

- 复杂性增加。虽然这种方法提高了性能和内存效率，但实现和维护的复杂性也有所增加，特别是在确保文件操作的原子性和数据完整性方面。
- 本地存储限制。依赖本地存储空间，可能会受到硬件限制，如果嵌入向量数据量非常大，可能需要频繁监控和管理存储资源。
- 不支持分布式访问。由于数据存储在本地文件系统中，不支持跨服务器或分布式系统访问，限制了应用场景。

### 示例：Sweep + Redis

[Our simple vector database implementation](https://docs.sweep.dev/blogs/vector-db-implementation)

优势：

- 管理多个索引的复杂性：
    - 标准的向量数据库在处理单个索引时表现良好，但在管理多个索引、频繁更新和自托管时变得复杂。
    - 使用 Redis 可以简化这一过程，无需管理多个索引和重建索引的问题。
- 基础设施和依赖管理：
    - 使用外部存储（如 Pinecone）会引入额外的依赖和潜在的故障点。
    - Redis 是一个流行的开源内存数据库，可以轻松自托管，减少了对外部服务的依赖。
- 缓存机制：
    - Redis 非常适合缓存用途，可以快速读取和写入数据，这对于频繁访问的 Embedding 向量非常重要。
    - 通过使用 Redis，系统可以缓存 Embedding 结果，减少对 OpenAI API 的调用次数，降低成本和延迟。

缺点：

- 该方法速度较慢（每个查询大约1秒），但满足他们的需求。
- 系统在超过 100 万个嵌入向量时扩展性不佳，但符合他们当前的需求（通常每个代码库文件少于30k）。

### 示例：通义灵码 + RocksDB

```bash
/Users/phodal/.lingma/tmp/cache/v3.3
├── 000001.vlog
├── 00001.mem
├── DISCARD
├── KEYREGISTRY
├── LOCK
└── MANIFEST
```

